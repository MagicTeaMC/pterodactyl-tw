import n,{createContext as t,useContext as r,useRef as e,useReducer as o,useState as u,useEffect as i,useLayoutEffect as c}from"react";import{compose as f,createStore as a,applyMiddleware as s}from"redux";import v from"redux-thunk";import{isDraft as l,current as d,Immer as p}from"immer";import y from"memoizerific";import{isPlainObject as m}from"is-plain-object";import{useMemoOne as h}from"use-memo-one";var S=t(),g="undefined"!=typeof window?c:i;function w(n){return function(t,u){var i=r(n),c=e(t),f=e(),a=e(!0),s=e(),v=o(function(n){return n+1},0)[1];if(s.current||c.current!==t||void 0===f.current)try{f.current=t(i.getState())}catch(n){if("development"===process.env.NODE_ENV){var l="An error occurred trying to map state in a useStoreState hook: "+n.message+".";throw s.current&&(l+="\nThis error may be related to the following error:\n"+s.current.stack+"\n\nOriginal stack trace:"),new Error(l)}throw s.current||n}return g(function(){c.current=t,s.current=void 0}),g(function(){var n=function(){try{var n=c.current(i.getState());if("function"==typeof u?u(f.current,n):f.current===n)return;f.current=n}catch(n){s.current=n}a.current&&v({})},t=i.subscribe(n);return n(),function(){a.current=!1,t()}},[]),f.current}}var b=w(S);function P(n){return function(t){return t(r(n).getActions())}}var j=P(S);function O(n){return function(){return r(n).dispatch}}var _=O(S);function A(){return r(S)}function k(n){return function(){var t=r(n),e=u(!1),o=e[0],c=e[1];return i(function(){t.persist.resolveRehydration().then(function(){return c(!0)})},[]),o}}var I=k(S);function R(){return{useStoreActions:j,useStoreDispatch:_,useStoreState:b,useStoreRehydrated:I,useStore:A}}function T(){return(T=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}return n}).apply(this,arguments)}var C=function(n){return l(n)?d(n):n},D=function(n,t){return y(t)(n)},M=function(n,t){var r;return(r={}).$ep_aO=!0,r.fn=t,r.targetResolver=n,r},E=function(n){var t;return(t={}).$ep_a=!0,t.fn=n,t},N=[function(n){return n}],x=function(n,t){var r,e;return"function"==typeof t?((e={}).$ep_c=!0,e.fn=t,e.stateResolvers=n,e):((r={}).$ep_c=!0,r.fn=n,r.stateResolvers=N,r)};function z(n,t){var r;return(r={}).$ep_e=!0,r.dependencyResolvers=n,r.fn=t,r}function J(n){return n}var F=function(n,t){var r;return"undefined"==typeof window?n:T({},n,((r={}).$ep_p=t,r))},L=function(n,t){var r;return(r={}).$ep_tO=!0,r.fn=t,r.targetResolver=n,r},V=function(n){var t;return(t={}).$ep_t=!0,t.fn=n,t},Y=function(n){var t;return(t={}).$ep_r=!0,t.fn=n,t},$=new p({useProxies:!0,autoFreeze:!1}),q=function(n){return function n(t){var r=Object.keys(t).reduce(function(n,r){return null==Object.getOwnPropertyDescriptor(t,r).get&&(n[r]=t[r]),n},{});return Object.keys(r).forEach(function(t){m(r[t])&&(r[t]=n(r[t]))}),r}(n)},B=function(n){return null!=n&&"object"==typeof n&&"function"==typeof n.then};function G(n,t){return n.reduce(function(n,t){return m(n)?n[t]:void 0},t)}var H=function(n,t,r){0!==n.length?n.reduce(function(t,e,o){return t[e]=o+1===n.length?r:t[e]||{},t[e]},t):"object"==typeof r&&(Object.keys(t).forEach(function(n){delete t[n]}),Object.keys(r).forEach(function(n){t[n]=r[n]}))},K=function(n){try{var t=[];return Promise.resolve((r=n,new Promise(function(n,e){var o=r[Symbol.iterator]();!function r(u){try{var i=o.next();if(i.done)return n(u),Promise.resolve();var c=function(n,e){try{var o=Promise.resolve(Promise.all([u,i.value])).then(function(n){r(function(n,r){try{return Promise.resolve(r()).then(function(n){t.push(n)})}catch(n){return Promise.reject(n)}}(0,n[1]))})}catch(n){return e(n)}return o&&o.then?o.then(void 0,e):o}(0,function(n){e(n)});return Promise.resolve(c&&c.then?c.then(function(){}):void 0)}catch(n){return Promise.reject(n)}}(void 0)}))).then(function(){return t})}catch(n){return Promise.reject(n)}var r};function Q(n,t,r,e){var o=function(n){return void 0===n&&(n=!1),function(t,r,e){if(n){var o=G(t,r),u=e(o);return o!==u?function n(t,r,e){if(0===t.length)return e;var o=T({},r),u=t[0];return o[u]=1===t.length?e:n(t.slice(1),o[u],e),o}(t,r,u):r}if(0===t.length){var i=$.createDraft(r),c=e(i);return c?l(c)?$.finishDraft(c):c:$.finishDraft(i)}var f=t.slice(0,t.length-1),a=$.createDraft(r),s=G(f,r),v=e(G(t,a));return v&&(s[t[t.length-1]]=v),$.finishDraft(a)}}(n);return function(n,u){var i=function(n,r){var e=t[r.type];return e?function(n,t,r,e){return o(e,n,function(n){return r(n,t.payload)})}(n,r,e,e.definition.meta.parent):n}(n,u),c=r.length>0?function(n,t){return r.reduce(function(n,r){var e=r.key,u=r.reducer;return o(r.parentPath,n,function(n){return n[e]=u(n[e],t),n})},n)}(i,u):i;return n!==c&&e.forEach(function(n){var t=n.bindComputedProperty,r=G(n.parentPath,c);null!=r&&t(r,c)}),c}}var U={getItem:function(){},setItem:function(){},removeItem:function(){}},W=function(n){var t;return function(){if(!t){try{"undefined"!=typeof window&&void 0!==window[n]&&(t=window[n])}catch(n){}t||(t=U)}return t}},X=W("localStorage"),Z=W("sessionStorage");function nn(n,t){void 0===t&&(t=[]),null==n&&(n=Z()),"string"==typeof n&&("localStorage"===n?n=X():"sessionStorage"===n?n=Z():("development"===process.env.NODE_ENV&&console.warn("Invalid storage provider specified for Easy Peasy persist: "+n+'\nValid values include "localStorage", "sessionStorage" or a custom storage engine.'),n=U));var r=[].concat(t).reverse(),e=function(t){var e=n===X()||n===Z()?JSON.parse(t).data:t;return r.length>0&&null!=e&&"object"==typeof e&&Object.keys(e).forEach(function(n){e[n]=r.reduce(function(t,r){return r.out(t,n)},e[n])}),e},o=B(n.getItem("_"));return{isAsync:o,getItem:function(t){if(o)return n.getItem(t).then(function(n){return null!=n?e(n):void 0});var r=n.getItem(t);return null!=r?e(r):void 0},setItem:function(r,e){return n.setItem(r,function(r){return t.length>0&&null!=r&&"object"==typeof r&&Object.keys(r).forEach(function(n){r[n]=t.reduce(function(t,r){return r.in(t,n)},r[n])}),n===X()||n===Z()?JSON.stringify({data:r}):r}(e))},removeItem:function(t){return n.removeItem(t)}}}function tn(n,t){return function(){return 0===t.internals.t.length?Promise.resolve():K(t.internals.t.map(function(t){var r=t.path,e=t.config;return function(){return Promise.resolve(e.storage.removeItem(n(r)))}}))}}function rn(n,t,r,e){return 0===r.internals.t.length?Promise.resolve():K(r.internals.t.map(function(o){return function(){var u=o.path,i=o.config,c=i.mergeStrategy,f=i.storage;if(e&&(u.length<1||u[0]!==e))return Promise.resolve();var a=r.internals.o,s=function(n,t){return null!=n&&null!=t&&(typeof n!=typeof t||Array.isArray(n)&&!Array.isArray(t))},v=function(n){null!=n&&function(n,t){if("overwrite"===c)H(u,n,t);else if("mergeShallow"===c){var r=G(u,n);Object.keys(t).forEach(function(n){s(r[n],t[n])||(r[n]=t[n])})}else"mergeDeep"===c&&function n(t,r){Object.keys(r).forEach(function(e){s(t[e],r[e])||(m(r[e])?(t[e]=t[e]||{},n(t[e],r[e])):t[e]=r[e])})}(G(u,n),t)}(a,n),t(a)},l=f.getItem(n(u));return B(l)?l.then(v):Promise.resolve(v(l))}}))}var en=function(n,t){console.log("An error occurred in a listener for "+n),console.log(t)},on=function(n,t){return function(){try{var r=t.apply(void 0,[].slice.call(arguments));B(r)&&r.catch(function(t){en(n,t)})}catch(t){en(n,t)}}};function un(n){return function(){return function(t){return function(r){var e=t(r);if(r&&n.internals.u[r.type]&&n.internals.u[r.type].length>0){var o=n.internals.i[r.type];n.internals.u[r.type].forEach(function(n){n({type:o?o.definition.meta.type:r.type,payload:r.payload,error:r.error,result:r.result})})}return e}}}}function cn(n){return function(t){return function(r){return function(e){return n.internals.s.currentState=t.getState(),n.internals.s.isInReducer=!0,r(e)}}}}function fn(n){return function(t){return function(r){return function(e){if(0===n.internals.v.length)return r(e);var o=t.getState(),u=r(e),i=t.getState();return n.internals.v.forEach(function(n){var t=G(n.meta.parent,o),r=G(n.meta.parent,i);if(t!==r){var u=n.dependencyResolvers.map(function(n){return n(t)}),c=n.dependencyResolvers.map(function(n){return n(r)});u.some(function(n,t){return n!==c[t]})&&n.actionCreator(u,c,e)}}),u}}}}var an=function(n){console.log(n)},sn=function(n,t){console.log("An error occurred in a listener for "+n),console.log(t)},vn=function(n,t){return function(){try{var r=t.apply(void 0,[].slice.call(arguments));B(r)&&r.catch(function(t){sn(n,t)})}catch(t){sn(n,t)}}};function ln(n,t){void 0===t&&(t={});var r=q(n),e=t.compose,o=t.devTools,u=void 0===o?"production"!==process.env.NODE_ENV:o,i=t.disableImmer,c=void 0!==i&&i,l=t.enhancers,d=void 0===l?[]:l,p=t.initialState,h=void 0===p?{}:p,S=t.injections,g=void 0===S?{}:S,w=t.middleware,b=void 0===w?[]:w,P=t.mockActions,j=void 0!==P&&P,O=t.name,_=void 0===O?"EasyPeasyStore":O,A=t.version,k=void 0===A?0:A,I=t.reducerEnhancer,R=void 0===I?function(n){return n}:I;if("production"!==process.env.NODE_ENV&&"object"!=typeof g)throw new Error("[easy-peasy] Store injections must be an object");var C=function(n){return T({},n,{ePRS:E(function(n,t){return t})})},D={},M=C(r),N=[],x=function(n){return"["+_+"]["+k+"]"+(n.length>0?"["+n.join(".")+"]":"")},z=function(n,t){var r,e=Promise.resolve(),o=!1,u="undefined"==typeof window?function(n){return n()}:null!=window.requestIdleCallback?window.requestIdleCallback:window.requestAnimationFrame;return{persist:function(i){if(0!==t.internals.t.length){var c=function(){o=!0,e=new Promise(function(e){u(function(){K(t.internals.t.map(function(t){var r=t.path,e=t.config;return function(){var t=e.storage,o=e.allow,u=e.deny,c=function(n,t,r){var e=Object.keys(n);return t.length>0&&(e=e.reduce(function(n,r){return-1!==t.findIndex(function(n){return n===r})?[].concat(n,[r]):n},[])),r.length>0&&(e=e.reduce(function(n,t){return-1!==r.findIndex(function(n){return n===t})?n:[].concat(n,[t])},[])),e}(q(G(r,i)),o,u),f={};return c.map(function(n){var t=G([].concat(r,[n]),i),e=m(t)?q(t):t;f[n]=e}),Promise.resolve(t.setItem(n(r),f))}})).finally(function(){if(o=!1,r){var n=r;r=null,n()}else e()})})})};o?r=c:c()}},clear:tn(n,t),flush:function(){try{return r&&r(),Promise.resolve(e).then(function(){})}catch(n){return Promise.reject(n)}}}}(x,D),J=function(n,t){return function(r){var e=r.getState;return function(r){return function(o){var u=r(o);return o&&"@action.ePRS"!==o.type&&t.internals.t.length>0&&n.persist(e()),u}}}}(z,D),F=function(n){return D.internals.i["@action.ePRS"](n)},L=function(n){void 0===n&&(n={}),D.internals=function(n){var t=n.disableImmer,r=n.reducerEnhancer,e=function(n,t,r,e){var o=t,u={},i={},c={},f={},a=[],s=[],v=[],l={},d={},p=[],h=[],S={isInReducer:!1,currentState:o};return h=h.sort(function(n,t){var r=n.path.join("."),e=t.path.join(".");return r<e?-1:r>e?1:0}),function n(d,S){return Object.keys(d).forEach(function(g){var w=d[g],b=[].concat(S,[g]),P={parent:S,path:b,key:g},j=function(){var n=G(S,t);H(b,o,n&&g in n?n[g]:w)};if("$ep_p"!==g)if(null!=w&&"object"==typeof w)if(w.$ep_a||w.$ep_aO){var O=T({},w),_=O.$ep_a?"@action":"@actionOn";O.meta={actionName:P.key,category:_,type:_+"."+P.path.join("."),parent:P.parent,path:P.path},O.actionCreator=function(n,t){var r=function(r){var e={type:n.meta.type,payload:r};return n.$ep_aO&&n.meta.resolvedTargets&&(r.resolvedTargets=[].concat(n.meta.resolvedTargets)),t.dispatch(e)};return r.type=n.meta.type,r}(O,e),O.actionCreator.definition=O,O.fn.definition=O,u[O.meta.type]=O.actionCreator,c[O.meta.type]=O.fn,"ePRS"!==P.key&&(O.$ep_aO?(p.push(O),H(b,l,O.actionCreator)):H(b,i,O.actionCreator))}else if(w.$ep_t||w.$ep_tO){var A=T({},w),k=(A.$ep_t?"@thunk":"@thunkOn")+"."+P.path.join(".");A.meta={actionName:P.key,parent:P.parent,path:P.path,type:k,startType:k+"(start)",successType:k+"(success)",failType:k+"(fail)"},A.thunkHandler=function(n,t,r,e){return function(o,u){var i={dispatch:t.dispatch,fail:u,getState:function(){return G(n.meta.parent,t.getState())},getStoreActions:function(){return e},getStoreState:t.getState,injections:r,meta:{key:n.meta.actionName,parent:n.meta.parent,path:n.meta.path}};return n.$ep_tO&&n.meta.resolvedTargets&&(o.resolvedTargets=[].concat(n.meta.resolvedTargets)),n.fn(G(n.meta.parent,e),o,i)}}(A,e,r,i),H(b,f,A.thunkHandler),A.actionCreator=function(n,t){var r=function(r){var e=on(n.meta.startType,function(){return t.dispatch({type:n.meta.startType,payload:r})}),o=on(n.meta.failType,function(e){return t.dispatch({type:n.meta.failType,payload:r,error:e})}),u=on(n.meta.successType,function(e){return t.dispatch({type:n.meta.successType,payload:r,result:e})});e();var i=null,c=function(n){i=n},f=t.dispatch(function(){return n.thunkHandler(r,c)});return B(f)?f.then(function(n){return i?o(i):u(n),n}):(i?o(i):u(f),f)};return r.type=n.meta.type,r.successType=n.meta.successType,r.failType=n.meta.failType,r.startType=n.meta.startType,r}(A,e),A.actionCreator.definition=A,u[A.meta.type]=A.actionCreator,A.$ep_tO?(p.push(A),H(b,l,A.actionCreator)):H(b,i,A.actionCreator)}else if(w.$ep_c){var I=G(S,o),R=function(n,t,r,e,o){var u=y(1)(r.fn);return function(e,o){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){var t=G(n,o),e=r.stateResolvers.map(function(n){return n(t,o)});return u.apply(void 0,e)}})}}(S,g,w);R(I,o),a.push({key:g,parentPath:S,bindComputedProperty:R})}else if(w.$ep_r)s.push({key:g,parentPath:S,reducer:w.fn});else if(w.$ep_e){var C=T({},w),D="@effectOn."+P.path.join(".");C.meta={type:D,actionName:P.key,parent:P.parent,path:P.path,startType:D+"(start)",successType:D+"(success)",failType:D+"(fail)"};var M=function(n,t,r,e){var o,u=G(n.meta.parent,e);return function(i){var c={dispatch:t.dispatch,getState:function(){return G(n.meta.parent,t.getState())},getStoreActions:function(){return e},getStoreState:t.getState,injections:r,meta:{key:n.meta.actionName,parent:n.meta.parent,path:n.meta.path}};if(void 0!==o){var f=o();o=void 0,B(f)&&f.catch(an)}var a=n.fn(u,i,c);if(B(a))return a.then(function(n){"function"==typeof n&&"production"!==process.env.NODE_ENV&&console.warn("[easy-peasy] You have an effect which is asynchronously resolving a dispose function. This is considered an anti-pattern. Please read the API documentation for more information.")});"function"==typeof a&&(o=a)}}(C,e,r,i),E=function(n,t,r){var e=function(e,o,u){var i={prev:e,current:o,action:u},c=vn(n.meta.startType,function(){return t.dispatch({type:n.meta.startType,change:i})}),f=vn(n.meta.successType,function(){return t.dispatch({type:n.meta.successType,change:i})});c();try{var a=t.dispatch(function(){return r(i)});return B(a)?a.then(function(n){return f(n),n},an):(f(a),a)}catch(n){an(n)}};return e.type=n.meta.type,e.startType=n.meta.startType,e.successType=n.meta.successType,e.failType=n.meta.failType,e}(C,e,M);C.actionCreator=E,v.push(C)}else m(w)?(null==G(b,o)&&H(b,o,{}),n(w,b)):j();else j();else h.push(function(n,t){return void 0===t&&(t={}),{path:n,config:{allow:t.allow||[],deny:t.deny||[],mergeStrategy:t.mergeStrategy||"mergeDeep",storage:nn(t.storage,t.transformers)}}}(S,w))})}(n,[]),function(n,t,r,e){n.forEach(function(n){var o=n.targetResolver(G(n.meta.parent,t),t),u=(Array.isArray(o)?o:[o]).reduce(function(n,t){return"function"==typeof t&&t.definition.meta.type&&r[t.definition.meta.type]?t.definition.meta.successType?(n.push(t.definition.meta.successType),n.push(t.definition.meta.failType)):n.push(t.definition.meta.type):"string"==typeof t&&n.push(t),n},[]);n.meta.resolvedTargets=u,u.forEach(function(t){var o=e[t]||[];o.push(r[n.meta.type]),e[t]=o})})}(p,i,u,d),{i:u,l:i,p:c,m:a,h:s,s:S,o:o,v:v,S:l,u:d,t:h}}(n.model,n.initialState,n.injections,n.references),o=e.m;return{i:e.i,l:e.l,m:o,s:e.s,o:e.o,v:e.v,S:e.S,u:e.u,t:e.t,reducer:r(Q(t,e.p,e.h,o))}}({disableImmer:c,initialState:n,injections:g,model:M,reducerEnhancer:R,references:D})},V=e||(u&&"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({name:_}):f);L(h);var Y=[cn(D)].concat(b,[v,un(D),fn(D),J]);j&&Y.push(function(){return function(){return function(n){null!=n&&N.push(n)}}});var $=a(D.internals.reducer,D.internals.o,V.apply(void 0,[s.apply(void 0,Y)].concat(d)));$.subscribe(function(){D.internals.s.isInReducer=!1}),D.dispatch=$.dispatch,D.getState=$.getState;var U=function(){Object.keys($.dispatch).forEach(function(n){delete $.dispatch[n]}),Object.keys(D.internals.l).forEach(function(n){$.dispatch[n]=D.internals.l[n]})};U();var W=function(n){var t=$.getState();n&&delete t[n],L(t),$.replaceReducer(D.internals.reducer),F(D.internals.o),U()},X=rn(x,F,D);return Object.assign($,{addModel:function(n,t){M[n]&&"production"!==process.env.NODE_ENV&&(console.warn('easy-peasy: The store model already contains a model definition for "'+n+'"'),$.removeModel(n)),M[n]=t,W();var r=rn(x,F,D,n);return{resolveRehydration:function(){return r}}},clearMockedActions:function(){N=[]},getActions:function(){return D.internals.l},getListeners:function(){return D.internals.S},getMockedActions:function(){return[].concat(N)},persist:{clear:z.clear,flush:z.flush,resolveRehydration:function(){return X}},reconfigure:function(n){M=C(n),W()},removeModel:function(n){M[n]?(delete M[n],W(n)):"production"!==process.env.NODE_ENV&&console.warn('easy-peasy: The store model does not contain a model definition for "'+n+'"')}})}function dn(e,o){void 0===o&&(o={});var u=o.injections,i=void 0===u?{}:u,c=t();return{Provider:function(t){var r=t.children,u=t.runtimeModel,f=t.injections;if(null!=f){var a="function"==typeof f?f(i):f,s=Object.keys(a);Object.keys(i).filter(function(n){return!s.includes(n)}).forEach(function(n){delete i[n]}),Object.assign(i,a)}var v=h(function(){return ln("function"==typeof e?e(u):e,T({},o,{originalInjections:i}))},[]);return n.createElement(c.Provider,{value:v},r)},useStore:function(){return r(c)},useStoreState:w(c),useStoreActions:P(c),useStoreDispatch:O(c),useStoreRehydrated:k(c)}}function pn(n,t,r){void 0===r&&(r={});var e=r.whitelist||null,o=r.blacklist||null;function u(n){return!(!e||-1!==e.indexOf(n))||!(!o||-1===o.indexOf(n))}return{in:function(t,r,e){return!u(r)&&n?n(t,r,e):t},out:function(n,r,e){return!u(r)&&t?t(n,r,e):n}}}function yn(t){return n.createElement(S.Provider,{value:t.store},t.children)}function mn(n,t,r){void 0===t&&(t=[]);var o=e(),c=e(),f=h(function(){var t=null!=o.current?o.current.getState():void 0,e=null!=r?r(t,c.current):void 0,u=ln(n(t),e);return c.current=e,o.current=u,u},t),a=u(function(){return f.getState()}),s=a[0],v=a[1];return i(function(){return f.subscribe(function(){var n=f.getState();s!==n&&v(n)})},[f]),[s,f.getActions(),f]}export{yn as StoreProvider,E as action,M as actionOn,x as computed,dn as createContextStore,ln as createStore,pn as createTransform,R as createTypedHooks,C as debug,J as generic,D as memo,F as persist,Y as reducer,V as thunk,L as thunkOn,z as unstable_effectOn,mn as useLocalStore,A as useStore,j as useStoreActions,_ as useStoreDispatch,I as useStoreRehydrated,b as useStoreState};
//# sourceMappingURL=easy-peasy.esm.js.map
