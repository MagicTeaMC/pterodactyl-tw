!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("redux"),require("redux-thunk"),require("immer"),require("memoizerific"),require("is-plain-object"),require("use-memo-one")):"function"==typeof define&&define.amd?define(["exports","react","redux","redux-thunk","immer","memoizerific","is-plain-object","use-memo-one"],t):t((n=n||self).easyPeasy={},n.react,n.redux,n.reduxThunk,n.immer,n.memoizerific,n.isPlainObject,n.useMemoOne)}(this,function(n,t,r,e,o,u,i,c){var f="default"in t?t.default:t;e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,u=u&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u;var a=t.createContext(),s="undefined"!=typeof window?t.useLayoutEffect:t.useEffect;function v(n){return function(r,e){var o=t.useContext(n),u=t.useRef(r),i=t.useRef(),c=t.useRef(!0),f=t.useRef(),a=t.useReducer(function(n){return n+1},0)[1];if(f.current||u.current!==r||void 0===i.current)try{i.current=r(o.getState())}catch(n){if("development"===process.env.NODE_ENV){var v="An error occurred trying to map state in a useStoreState hook: "+n.message+".";throw f.current&&(v+="\nThis error may be related to the following error:\n"+f.current.stack+"\n\nOriginal stack trace:"),new Error(v)}throw f.current||n}return s(function(){u.current=r,f.current=void 0}),s(function(){var n=function(){try{var n=u.current(o.getState());if("function"==typeof e?e(i.current,n):i.current===n)return;i.current=n}catch(n){f.current=n}c.current&&a({})},t=o.subscribe(n);return n(),function(){c.current=!1,t()}},[]),i.current}}var d=v(a);function l(n){return function(r){return r(t.useContext(n).getActions())}}var p=l(a);function y(n){return function(){return t.useContext(n).dispatch}}var m=y(a);function h(){return t.useContext(a)}function S(n){return function(){var r=t.useContext(n),e=t.useState(!1),o=e[0],u=e[1];return t.useEffect(function(){r.persist.resolveRehydration().then(function(){return u(!0)})},[]),o}}var g=S(a);function b(){return(b=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}return n}).apply(this,arguments)}var j=function(n){var t;return(t={}).$ep_a=!0,t.fn=n,t},w=[function(n){return n}],P=new o.Immer({useProxies:!0,autoFreeze:!1}),O=function(n){return function n(t){var r=Object.keys(t).reduce(function(n,r){return null==Object.getOwnPropertyDescriptor(t,r).get&&(n[r]=t[r]),n},{});return Object.keys(r).forEach(function(t){i.isPlainObject(r[t])&&(r[t]=n(r[t]))}),r}(n)},_=function(n){return null!=n&&"object"==typeof n&&"function"==typeof n.then};function A(n,t){return n.reduce(function(n,t){return i.isPlainObject(n)?n[t]:void 0},t)}var k=function(n,t,r){0!==n.length?n.reduce(function(t,e,o){return t[e]=o+1===n.length?r:t[e]||{},t[e]},t):"object"==typeof r&&(Object.keys(t).forEach(function(n){delete t[n]}),Object.keys(r).forEach(function(n){t[n]=r[n]}))},I=function(n){try{var t=[];return Promise.resolve((r=n,new Promise(function(n,e){var o=r[Symbol.iterator]();!function r(u){try{var i=o.next();if(i.done)return n(u),Promise.resolve();var c=function(n,e){try{var o=Promise.resolve(Promise.all([u,i.value])).then(function(n){r(function(n,r){try{return Promise.resolve(r()).then(function(n){t.push(n)})}catch(n){return Promise.reject(n)}}(0,n[1]))})}catch(n){return e(n)}return o&&o.then?o.then(void 0,e):o}(0,function(n){e(n)});return Promise.resolve(c&&c.then?c.then(function(){}):void 0)}catch(n){return Promise.reject(n)}}(void 0)}))).then(function(){return t})}catch(n){return Promise.reject(n)}var r};function R(n,t,r,e){var u=function(n){return void 0===n&&(n=!1),function(t,r,e){if(n){var u=A(t,r),i=e(u);return u!==i?function n(t,r,e){if(0===t.length)return e;var o=b({},r),u=t[0];return o[u]=1===t.length?e:n(t.slice(1),o[u],e),o}(t,r,i):r}if(0===t.length){var c=P.createDraft(r),f=e(c);return f?o.isDraft(f)?P.finishDraft(f):f:P.finishDraft(c)}var a=t.slice(0,t.length-1),s=P.createDraft(r),v=A(a,r),d=e(A(t,s));return d&&(v[t[t.length-1]]=d),P.finishDraft(s)}}(n);return function(n,o){var i=function(n,r){var e=t[r.type];return e?function(n,t,r,e){return u(e,n,function(n){return r(n,t.payload)})}(n,r,e,e.definition.meta.parent):n}(n,o),c=r.length>0?function(n,t){return r.reduce(function(n,r){var e=r.key,o=r.reducer;return u(r.parentPath,n,function(n){return n[e]=o(n[e],t),n})},n)}(i,o):i;return n!==c&&e.forEach(function(n){var t=n.bindComputedProperty,r=A(n.parentPath,c);null!=r&&t(r,c)}),c}}var T={getItem:function(){},setItem:function(){},removeItem:function(){}},C=function(n){var t;return function(){if(!t){try{"undefined"!=typeof window&&void 0!==window[n]&&(t=window[n])}catch(n){}t||(t=T)}return t}},x=C("localStorage"),q=C("sessionStorage");function D(n,t){void 0===t&&(t=[]),null==n&&(n=q()),"string"==typeof n&&("localStorage"===n?n=x():"sessionStorage"===n?n=q():("development"===process.env.NODE_ENV&&console.warn("Invalid storage provider specified for Easy Peasy persist: "+n+'\nValid values include "localStorage", "sessionStorage" or a custom storage engine.'),n=T));var r=[].concat(t).reverse(),e=function(t){var e=n===x()||n===q()?JSON.parse(t).data:t;return r.length>0&&null!=e&&"object"==typeof e&&Object.keys(e).forEach(function(n){e[n]=r.reduce(function(t,r){return r.out(t,n)},e[n])}),e},o=_(n.getItem("_"));return{isAsync:o,getItem:function(t){if(o)return n.getItem(t).then(function(n){return null!=n?e(n):void 0});var r=n.getItem(t);return null!=r?e(r):void 0},setItem:function(r,e){return n.setItem(r,function(r){return t.length>0&&null!=r&&"object"==typeof r&&Object.keys(r).forEach(function(n){r[n]=t.reduce(function(t,r){return r.in(t,n)},r[n])}),n===x()||n===q()?JSON.stringify({data:r}):r}(e))},removeItem:function(t){return n.removeItem(t)}}}function M(n,t){return function(){return 0===t.internals.t.length?Promise.resolve():I(t.internals.t.map(function(t){var r=t.path,e=t.config;return function(){return Promise.resolve(e.storage.removeItem(n(r)))}}))}}function E(n,t,r,e){return 0===r.internals.t.length?Promise.resolve():I(r.internals.t.map(function(o){return function(){var u=o.path,c=o.config,f=c.mergeStrategy,a=c.storage;if(e&&(u.length<1||u[0]!==e))return Promise.resolve();var s=r.internals.o,v=function(n,t){return null!=n&&null!=t&&(typeof n!=typeof t||Array.isArray(n)&&!Array.isArray(t))},d=function(n){null!=n&&function(n,t){if("overwrite"===f)k(u,n,t);else if("mergeShallow"===f){var r=A(u,n);Object.keys(t).forEach(function(n){v(r[n],t[n])||(r[n]=t[n])})}else"mergeDeep"===f&&function n(t,r){Object.keys(r).forEach(function(e){v(t[e],r[e])||(i.isPlainObject(r[e])?(t[e]=t[e]||{},n(t[e],r[e])):t[e]=r[e])})}(A(u,n),t)}(s,n),t(s)},l=a.getItem(n(u));return _(l)?l.then(d):Promise.resolve(d(l))}}))}var N=function(n,t){console.log("An error occurred in a listener for "+n),console.log(t)},z=function(n,t){return function(){try{var r=t.apply(void 0,[].slice.call(arguments));_(r)&&r.catch(function(t){N(n,t)})}catch(t){N(n,t)}}};function J(n){return function(){return function(t){return function(r){var e=t(r);if(r&&n.internals.u[r.type]&&n.internals.u[r.type].length>0){var o=n.internals.i[r.type];n.internals.u[r.type].forEach(function(n){n({type:o?o.definition.meta.type:r.type,payload:r.payload,error:r.error,result:r.result})})}return e}}}}function F(n){return function(t){return function(r){return function(e){return n.internals.s.currentState=t.getState(),n.internals.s.isInReducer=!0,r(e)}}}}function L(n){return function(t){return function(r){return function(e){if(0===n.internals.v.length)return r(e);var o=t.getState(),u=r(e),i=t.getState();return n.internals.v.forEach(function(n){var t=A(n.meta.parent,o),r=A(n.meta.parent,i);if(t!==r){var u=n.dependencyResolvers.map(function(n){return n(t)}),c=n.dependencyResolvers.map(function(n){return n(r)});u.some(function(n,t){return n!==c[t]})&&n.actionCreator(u,c,e)}}),u}}}}var V=function(n){console.log(n)},Y=function(n,t){console.log("An error occurred in a listener for "+n),console.log(t)},$=function(n,t){return function(){try{var r=t.apply(void 0,[].slice.call(arguments));_(r)&&r.catch(function(t){Y(n,t)})}catch(t){Y(n,t)}}};function B(n,t){void 0===t&&(t={});var o=O(n),c=t.compose,f=t.devTools,a=void 0===f?"production"!==process.env.NODE_ENV:f,s=t.disableImmer,v=void 0!==s&&s,d=t.enhancers,l=void 0===d?[]:d,p=t.initialState,y=void 0===p?{}:p,m=t.injections,h=void 0===m?{}:m,S=t.middleware,g=void 0===S?[]:S,w=t.mockActions,P=void 0!==w&&w,T=t.name,C=void 0===T?"EasyPeasyStore":T,x=t.version,q=void 0===x?0:x,N=t.reducerEnhancer,Y=void 0===N?function(n){return n}:N;if("production"!==process.env.NODE_ENV&&"object"!=typeof h)throw new Error("[easy-peasy] Store injections must be an object");var B=function(n){return b({},n,{ePRS:j(function(n,t){return t})})},G={},H=B(o),K=[],Q=function(n){return"["+C+"]["+q+"]"+(n.length>0?"["+n.join(".")+"]":"")},U=function(n,t){var r,e=Promise.resolve(),o=!1,u="undefined"==typeof window?function(n){return n()}:null!=window.requestIdleCallback?window.requestIdleCallback:window.requestAnimationFrame;return{persist:function(c){if(0!==t.internals.t.length){var f=function(){o=!0,e=new Promise(function(e){u(function(){I(t.internals.t.map(function(t){var r=t.path,e=t.config;return function(){var t=e.storage,o=e.allow,u=e.deny,f=function(n,t,r){var e=Object.keys(n);return t.length>0&&(e=e.reduce(function(n,r){return-1!==t.findIndex(function(n){return n===r})?[].concat(n,[r]):n},[])),r.length>0&&(e=e.reduce(function(n,t){return-1!==r.findIndex(function(n){return n===t})?n:[].concat(n,[t])},[])),e}(O(A(r,c)),o,u),a={};return f.map(function(n){var t=A([].concat(r,[n]),c),e=i.isPlainObject(t)?O(t):t;a[n]=e}),Promise.resolve(t.setItem(n(r),a))}})).finally(function(){if(o=!1,r){var n=r;r=null,n()}else e()})})})};o?r=f:f()}},clear:M(n,t),flush:function(){try{return r&&r(),Promise.resolve(e).then(function(){})}catch(n){return Promise.reject(n)}}}}(Q,G),W=function(n,t){return function(r){var e=r.getState;return function(r){return function(o){var u=r(o);return o&&"@action.ePRS"!==o.type&&t.internals.t.length>0&&n.persist(e()),u}}}}(U,G),X=function(n){return G.internals.i["@action.ePRS"](n)},Z=function(n){void 0===n&&(n={}),G.internals=function(n){var t=n.disableImmer,r=n.reducerEnhancer,e=function(n,t,r,e){var o=t,c={},f={},a={},s={},v=[],d=[],l=[],p={},y={},m=[],h=[],S={isInReducer:!1,currentState:o};return h=h.sort(function(n,t){var r=n.path.join("."),e=t.path.join(".");return r<e?-1:r>e?1:0}),function n(y,S){return Object.keys(y).forEach(function(g){var j=y[g],w=[].concat(S,[g]),P={parent:S,path:w,key:g},O=function(){var n=A(S,t);k(w,o,n&&g in n?n[g]:j)};if("$ep_p"!==g)if(null!=j&&"object"==typeof j)if(j.$ep_a||j.$ep_aO){var I=b({},j),R=I.$ep_a?"@action":"@actionOn";I.meta={actionName:P.key,category:R,type:R+"."+P.path.join("."),parent:P.parent,path:P.path},I.actionCreator=function(n,t){var r=function(r){var e={type:n.meta.type,payload:r};return n.$ep_aO&&n.meta.resolvedTargets&&(r.resolvedTargets=[].concat(n.meta.resolvedTargets)),t.dispatch(e)};return r.type=n.meta.type,r}(I,e),I.actionCreator.definition=I,I.fn.definition=I,c[I.meta.type]=I.actionCreator,a[I.meta.type]=I.fn,"ePRS"!==P.key&&(I.$ep_aO?(m.push(I),k(w,p,I.actionCreator)):k(w,f,I.actionCreator))}else if(j.$ep_t||j.$ep_tO){var T=b({},j),C=(T.$ep_t?"@thunk":"@thunkOn")+"."+P.path.join(".");T.meta={actionName:P.key,parent:P.parent,path:P.path,type:C,startType:C+"(start)",successType:C+"(success)",failType:C+"(fail)"},T.thunkHandler=function(n,t,r,e){return function(o,u){var i={dispatch:t.dispatch,fail:u,getState:function(){return A(n.meta.parent,t.getState())},getStoreActions:function(){return e},getStoreState:t.getState,injections:r,meta:{key:n.meta.actionName,parent:n.meta.parent,path:n.meta.path}};return n.$ep_tO&&n.meta.resolvedTargets&&(o.resolvedTargets=[].concat(n.meta.resolvedTargets)),n.fn(A(n.meta.parent,e),o,i)}}(T,e,r,f),k(w,s,T.thunkHandler),T.actionCreator=function(n,t){var r=function(r){var e=z(n.meta.startType,function(){return t.dispatch({type:n.meta.startType,payload:r})}),o=z(n.meta.failType,function(e){return t.dispatch({type:n.meta.failType,payload:r,error:e})}),u=z(n.meta.successType,function(e){return t.dispatch({type:n.meta.successType,payload:r,result:e})});e();var i=null,c=function(n){i=n},f=t.dispatch(function(){return n.thunkHandler(r,c)});return _(f)?f.then(function(n){return i?o(i):u(n),n}):(i?o(i):u(f),f)};return r.type=n.meta.type,r.successType=n.meta.successType,r.failType=n.meta.failType,r.startType=n.meta.startType,r}(T,e),T.actionCreator.definition=T,c[T.meta.type]=T.actionCreator,T.$ep_tO?(m.push(T),k(w,p,T.actionCreator)):k(w,f,T.actionCreator)}else if(j.$ep_c){var x=A(S,o),q=function(n,t,r,e,o){var i=u(1)(r.fn);return function(e,o){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){var t=A(n,o),e=r.stateResolvers.map(function(n){return n(t,o)});return i.apply(void 0,e)}})}}(S,g,j);q(x,o),v.push({key:g,parentPath:S,bindComputedProperty:q})}else if(j.$ep_r)d.push({key:g,parentPath:S,reducer:j.fn});else if(j.$ep_e){var M=b({},j),E="@effectOn."+P.path.join(".");M.meta={type:E,actionName:P.key,parent:P.parent,path:P.path,startType:E+"(start)",successType:E+"(success)",failType:E+"(fail)"};var N=function(n,t,r,e){var o,u=A(n.meta.parent,e);return function(i){var c={dispatch:t.dispatch,getState:function(){return A(n.meta.parent,t.getState())},getStoreActions:function(){return e},getStoreState:t.getState,injections:r,meta:{key:n.meta.actionName,parent:n.meta.parent,path:n.meta.path}};if(void 0!==o){var f=o();o=void 0,_(f)&&f.catch(V)}var a=n.fn(u,i,c);if(_(a))return a.then(function(n){"function"==typeof n&&"production"!==process.env.NODE_ENV&&console.warn("[easy-peasy] You have an effect which is asynchronously resolving a dispose function. This is considered an anti-pattern. Please read the API documentation for more information.")});"function"==typeof a&&(o=a)}}(M,e,r,f),J=function(n,t,r){var e=function(e,o,u){var i={prev:e,current:o,action:u},c=$(n.meta.startType,function(){return t.dispatch({type:n.meta.startType,change:i})}),f=$(n.meta.successType,function(){return t.dispatch({type:n.meta.successType,change:i})});c();try{var a=t.dispatch(function(){return r(i)});return _(a)?a.then(function(n){return f(n),n},V):(f(a),a)}catch(n){V(n)}};return e.type=n.meta.type,e.startType=n.meta.startType,e.successType=n.meta.successType,e.failType=n.meta.failType,e}(M,e,N);M.actionCreator=J,l.push(M)}else i.isPlainObject(j)?(null==A(w,o)&&k(w,o,{}),n(j,w)):O();else O();else h.push(function(n,t){return void 0===t&&(t={}),{path:n,config:{allow:t.allow||[],deny:t.deny||[],mergeStrategy:t.mergeStrategy||"mergeDeep",storage:D(t.storage,t.transformers)}}}(S,j))})}(n,[]),function(n,t,r,e){n.forEach(function(n){var o=n.targetResolver(A(n.meta.parent,t),t),u=(Array.isArray(o)?o:[o]).reduce(function(n,t){return"function"==typeof t&&t.definition.meta.type&&r[t.definition.meta.type]?n.push(t.definition.meta.successType?t.definition.meta.successType:t.definition.meta.type):"string"==typeof t&&n.push(t),n},[]);n.meta.resolvedTargets=u,u.forEach(function(t){var o=e[t]||[];o.push(r[n.meta.type]),e[t]=o})})}(m,f,c,y),{i:c,l:f,p:a,m:v,h:d,s:S,o:o,v:l,S:p,u:y,t:h}}(n.model,n.initialState,n.injections,n.references),o=e.m;return{i:e.i,l:e.l,m:o,s:e.s,o:e.o,v:e.v,S:e.S,u:e.u,t:e.t,reducer:r(R(t,e.p,e.h,o))}}({disableImmer:v,initialState:n,injections:h,model:H,reducerEnhancer:Y,references:G})},nn=c||(a&&"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({name:C}):r.compose);Z(y);var tn=[F(G)].concat(g,[e,J(G),L(G),W]);P&&tn.push(function(){return function(){return function(n){null!=n&&K.push(n)}}});var rn=r.createStore(G.internals.reducer,G.internals.o,nn.apply(void 0,[r.applyMiddleware.apply(void 0,tn)].concat(l)));rn.subscribe(function(){G.internals.s.isInReducer=!1}),G.dispatch=rn.dispatch,G.getState=rn.getState;var en=function(){Object.keys(rn.dispatch).forEach(function(n){delete rn.dispatch[n]}),Object.keys(G.internals.l).forEach(function(n){rn.dispatch[n]=G.internals.l[n]})};en();var on=function(n){var t=rn.getState();n&&delete t[n],Z(t),rn.replaceReducer(G.internals.reducer),X(G.internals.o),en()},un=E(Q,X,G);return Object.assign(rn,{addModel:function(n,t){H[n]&&"production"!==process.env.NODE_ENV&&(console.warn('easy-peasy: The store model already contains a model definition for "'+n+'"'),rn.removeModel(n)),H[n]=t,on();var r=E(Q,X,G,n);return{resolveRehydration:function(){return r}}},clearMockedActions:function(){K=[]},getActions:function(){return G.internals.l},getListeners:function(){return G.internals.S},getMockedActions:function(){return[].concat(K)},persist:{clear:U.clear,flush:U.flush,resolveRehydration:function(){return un}},reconfigure:function(n){H=B(n),on()},removeModel:function(n){H[n]?(delete H[n],on(n)):"production"!==process.env.NODE_ENV&&console.warn('easy-peasy: The store model does not contain a model definition for "'+n+'"')}})}n.StoreProvider=function(n){return f.createElement(a.Provider,{value:n.store},n.children)},n.action=j,n.actionOn=function(n,t){var r;return(r={}).$ep_aO=!0,r.fn=t,r.targetResolver=n,r},n.computed=function(n,t){var r,e;return"function"==typeof t?((e={}).$ep_c=!0,e.fn=t,e.stateResolvers=n,e):((r={}).$ep_c=!0,r.fn=n,r.stateResolvers=w,r)},n.createContextStore=function(n,r){void 0===r&&(r={});var e=r.injections,o=void 0===e?{}:e,u=t.createContext();return{Provider:function(t){var e=t.children,i=t.runtimeModel,a=t.injections;if(null!=a){var s="function"==typeof a?a(o):a,v=Object.keys(s);Object.keys(o).filter(function(n){return!v.includes(n)}).forEach(function(n){delete o[n]}),Object.assign(o,s)}var d=c.useMemoOne(function(){return B("function"==typeof n?n(i):n,b({},r,{originalInjections:o}))},[]);return f.createElement(u.Provider,{value:d},e)},useStore:function(){return t.useContext(u)},useStoreState:v(u),useStoreActions:l(u),useStoreDispatch:y(u),useStoreRehydrated:S(u)}},n.createStore=B,n.createTransform=function(n,t,r){void 0===r&&(r={});var e=r.whitelist||null,o=r.blacklist||null;function u(n){return!(!e||-1!==e.indexOf(n))||!(!o||-1===o.indexOf(n))}return{in:function(t,r,e){return!u(r)&&n?n(t,r,e):t},out:function(n,r,e){return!u(r)&&t?t(n,r,e):n}}},n.createTypedHooks=function(){return{useStoreActions:p,useStoreDispatch:m,useStoreState:d,useStoreRehydrated:g,useStore:h}},n.debug=function(n){return o.isDraft(n)?o.current(n):n},n.generic=function(n){return n},n.memo=function(n,t){return u(t)(n)},n.persist=function(n,t){var r;return"undefined"==typeof window?n:b({},n,((r={}).$ep_p=t,r))},n.reducer=function(n){var t;return(t={}).$ep_r=!0,t.fn=n,t},n.thunk=function(n){var t;return(t={}).$ep_t=!0,t.fn=n,t},n.thunkOn=function(n,t){var r;return(r={}).$ep_tO=!0,r.fn=t,r.targetResolver=n,r},n.unstable_effectOn=function(n,t){var r;return(r={}).$ep_e=!0,r.dependencyResolvers=n,r.fn=t,r},n.useLocalStore=function(n,r,e){void 0===r&&(r=[]);var o=t.useRef(),u=t.useRef(),i=c.useMemoOne(function(){var t=null!=o.current?o.current.getState():void 0,r=null!=e?e(t,u.current):void 0,i=B(n(t),r);return u.current=r,o.current=i,i},r),f=t.useState(function(){return i.getState()}),a=f[0],s=f[1];return t.useEffect(function(){return i.subscribe(function(){var n=i.getState();a!==n&&s(n)})},[i]),[a,i.getActions(),i]},n.useStore=h,n.useStoreActions=p,n.useStoreDispatch=m,n.useStoreRehydrated=g,n.useStoreState=d});
//# sourceMappingURL=easy-peasy.umd.js.map
